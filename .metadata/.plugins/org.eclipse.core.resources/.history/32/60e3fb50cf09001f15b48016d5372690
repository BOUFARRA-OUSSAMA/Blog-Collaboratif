package net.javaguides.springboot.mapper;

import net.javaguides.springboot.dto.OrderDto;
import net.javaguides.springboot.model.CartItem;
import net.javaguides.springboot.model.Order;

import java.math.BigDecimal;
import java.util.List;
import java.util.stream.Collectors;

public class OrderMapper {

	public static OrderDto mapToOrderDto(Order order) {
	    OrderDto orderDto = new OrderDto();
	    orderDto.setId(order.getId());
	    orderDto.setUser(UserMapper.mapToUserDto(order.getUser()));
	    orderDto.setCartItems(CartItemMapper.mapToCartItemDtoList(order.getCartItems()));
	    orderDto.setOrderDate(order.getOrderDate());
	    orderDto.setStatus(order.getStatus());
	    return orderDto;
	}


    public static Order mapToOrder(OrderDto orderDto) {
        Order order = new Order();
        if (orderDto.getId() != null) {
            order.setId(orderDto.getId().longValue());
        }
        order.setUser(UserMapper.mapToUser(orderDto.getUser()));
        order.setCartItems(CartItemMapper.mapToCartItemList(orderDto.getCartItems()));
        order.setOrderDate(orderDto.getOrderDate());
        order.setStatus(orderDto.getStatus());
        return order;
    }

    public static List<OrderDto> mapToOrderDtoList(List<Order> orders) {
        return orders.stream()
                .map(OrderMapper::mapToOrderDto)
                .collect(Collectors.toList());
    }

    private static BigDecimal calculateTotalPrice(List<CartItem> cartItems) {
        BigDecimal totalPrice = BigDecimal.ZERO;
        for (CartItem cartItem : cartItems) {
            BigDecimal productPrice = cartItem.getProduct().getBasePrice();
            BigDecimal itemTotalPrice = productPrice.multiply(BigDecimal.valueOf(cartItem.getQuantity()));
            totalPrice = totalPrice.add(itemTotalPrice);
        }
        return totalPrice;
    }
}
